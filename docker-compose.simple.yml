version: '3.8'

services:
  # Simplified STT service for Podman testing
  stt-service:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: stt-service-test
    environment:
      - STT_LANGUAGE=en
      - STT_MODEL_TYPE=faster-whisper
      - STT_MODEL_SIZE=tiny  # Use tiny model for faster container testing
      - STT_OUTPUT_METHOD=keyboard
      - STT_HOTKEY=ctrl+shift+space
      - DISPLAY=${DISPLAY}
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      - /run/user/${UID}/pulse:/run/user/1000/pulse:rw
      - /dev/snd:/dev/snd:rw
    devices:
      - /dev/dri:/dev/dri  # For GPU access if available
    network_mode: host
    privileged: true  # Simplified for testing
    command: python cli.py run
    healthcheck:
      test: ["CMD", "python", "-c", "print('Service health check')"]
      interval: 30s
      timeout: 10s
      retries: 3